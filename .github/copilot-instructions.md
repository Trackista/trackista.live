# Инструкции для ИИ-агентов SharkChunk

## Обзор проекта
SharkChunk — это React-приложение для скрининга и построения графиков криптовалют с реальными данными из Binance API. Использует двойную архитектуру с CORS-прокси сервером для доступа к API и Vite-фронтенд.

## Архитектура и ключевые компоненты

### Двухсерверная конфигурация
- **Фронтенд**: Vite + React на `localhost:5173` 
- **Прокси-сервер**: Express.js на `localhost:3001` (обрабатывает CORS для Binance API)
- Всегда запускайте оба сервера: `npm run dev` (фронтенд) + `npm run proxy` (бэкенд)

### Основной поток данных
1. Хуки `useBinance.js` получают данные через кастомные сервисы
2. `binanceService.js` и `binanceFuturesService.js` обрабатывают API-коммуникацию через прокси
3. Компоненты потребляют данные через React hooks паттерн
4. WebSocket соединения обеспечивают обновления в реальном времени

### Архитектура компонентов
- `App.jsx`: Основной лейаут с боковой панелью + область графика
- `CoinListSidebar.jsx`: Фильтруемый список криптовалют с вкладками спот/фьючерсы и цветовой маркировкой избранного
- `KLineChart.jsx`: Интерактивные свечные графики на базе `klinecharts`
- Сервисы — singleton классы, хуки управляют состоянием + жизненным циклом

## Рабочие процессы разработки

### Запуск разработки
```bash
# Терминал 1 - Фронтенд
npm run dev

# Терминал 2 - Прокси-сервер  
npm run proxy
# ИЛИ: cd proxy-server && npm start
```

### Паттерн интеграции API
- Все вызовы к Binance идут через прокси: `http://localhost:3001/api/spot/` или `/api/futures/`
- Прокси переписывает пути: `/api/spot` → `https://api.binance.com/api/v3`
- Сервисы обрабатывают fallback к моковым данным при сбое прокси
- Смотрите `BINANCE_DATA.md` для примеров использования API

### Обработка данных графиков
KLineCharts ожидает специфический формат: `{timestamp, open, high, low, close, volume}`
- Binance возвращает массивы, конвертируйте: `[timestamp, open, high, low, close, volume, ...]`
- Используйте `parseFloat()` для числовых значений, timestamp остается как число
- Обрабатывайте отсутствующие данные корректно с генерацией тестовых данных
- Используйте `applyNewData()` для обновления графика

## Специфические паттерны проекта

### Управление состоянием
- Без Redux/Context — использует React hooks + паттерн сервисов
- `useBinance.js` предоставляет: `useBinanceScreener`, `useBinanceFutures`, `useBinanceWebSocket`
- Сервисы без состояния, хуки управляют loading/error состояниями

### Коммуникация компонентов
- Parent-child props для передачи данных (выбор монеты, переключение вкладок)
- Общее состояние поднято на уровень `App.jsx`
- Event handlers передаются вниз: `onCoinSelect`, `onTabChange`

### Стратегия обработки ошибок
- Сервисы выбрасывают ошибки, хуки ловят и устанавливают error state
- Компоненты показывают fallback UI с инструкциями по настройке прокси
- Моковые данные служат для graceful degradation при сбое API

### Соглашения по стилизации
- Bootstrap 5 для лейаута + компонентов
- Кастомный CSS в `src/styles/global.css` для переопределения темы
- Inline стили для динамических элементов (цветовые точки, индикаторы перетаскивания)
- Адаптивный дизайн с Bootstrap grid system

## Ключевые файлы для понимания

- `src/hooks/useBinance.js` - Паттерны получения данных и управление WebSocket
- `src/services/binanceService.js` - Абстракция API и трансформация данных
- `proxy-server/server.js` - Конфигурация CORS прокси и роутинг
- `src/components/KLineChart.jsx` - Интерактивные графики на базе klinecharts
- `src/components/CoinListSidebar.jsx` - Сложные UI взаимодействия (drag-drop, цветовое кодирование)

## Точки интеграции

### Интеграция с Binance API
- Spot API: `api.binance.com/api/v3` (через прокси `/api/spot`)
- Futures API: `fapi.binance.com/fapi/v1` (через прокси `/api/futures`)  
- WebSocket: `wss://stream.binance.com:9443/ws` для данных в реальном времени
- Все символы нормализованы к USDT парам, фильтрует левереджные токены

### Внешние зависимости
- `klinecharts` для интерактивных финансовых графиков
- `axios` для HTTP запросов с обработкой timeout'ов
- Bootstrap для UI компонентов и адаптивного лейаута

При добавлении новых функций следуйте установленному паттерну service → hook → component и убедитесь, что оба пути данных spot/futures работают корректно.